<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lecture 6: Purely Functional State</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
</head>
<body style="!important;">
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Lecture 6: Purely Functional State</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              1/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p><img src="images/lecture6/von-neumann.jpg"  height="300" >
<br>
<br></p>
<p>"Anyone who attempts to generate random numbers by deterministic means is, of course, living in a state of sin." </p>
<p>-- <a href="https://en.wikipedia.org/wiki/John_von_Neumann">John von Neumann</a> </p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              2/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Just as a mathematical function always calculates the same output for a given input, so does a <em>referentially transparent</em> function in functional programming.
<br />
In this lecture we will build an API for pseudo-random number generators that obeys this rule.
<br />
Furthermore, the combinators in our API will prevent the re-generation of the same "random" number.  This particular error will not be a concern of our library's user.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              3/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We start with a <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">linear congruential generator</a>:
<br /></p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">generateSeed</span><span class="o">(</span><span class="n">seed</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span>
  <span class="o">(</span><span class="n">seed</span> <span class="o">*</span> <span class="mh">0x5DEECE66D</span><span class="n">L</span> <span class="o">+</span> <span class="mh">0xB</span><span class="n">L</span><span class="o">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFF</span><span class="n">L</span>

<span class="k">def</span> <span class="n">generateInt</span><span class="o">(</span><span class="n">seed</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="o">(</span><span class="n">seed</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">16</span><span class="o">).</span><span class="n">toInt</span>
</pre></div>

<p><br />
<br />
<br />
<br />
<br />
<br />
Defined in <code>slideCode.lecture6.PseudoRandomNumberGenerator</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              4/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code has_notes">
          <div class="inner">
            
            
            <section><p><code>RNG</code> generates a "random" Integer, and another <code>RNG</code>, in a tuple.  RNG =&gt; (Int, RNG)
<br /></p>
<div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">RNG</span><span class="o">(</span><span class="n">seed0</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">nextInt</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">seed1</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="n">generateSeed</span><span class="o">(</span><span class="n">seed0</span><span class="o">)</span>
    <span class="k">val</span> <span class="n">int1</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">generateInt</span><span class="o">(</span><span class="n">seed1</span><span class="o">)</span>
    <span class="k">val</span> <span class="n">rng1</span><span class="k">:</span> <span class="kt">RNG</span> <span class="o">=</span> <span class="nc">RNG</span><span class="o">(</span><span class="n">seed1</span><span class="o">)</span>
    <span class="o">(</span><span class="n">int1</span><span class="o">,</span> <span class="n">rng1</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p><br />
<br />
<br />
<br />
Defined in <code>lectureCode.lecture6.PseudoRandomNumberGenerator</code></p>
<p class="notes"><code>RNG</code> generates a "random" Integer, and another <code>RNG</code>, in a tuple.  RNG =&gt; (Int, RNG)</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              5/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>val simple = RNG(123)
val tup: (Int, RNG) = simple.nextInt
println(tup)
// (47324114,RNG(3101433181802))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              6/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>What does <code>iterate</code> do?</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">rng0</span> <span class="k">=</span> <span class="nc">RNG</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>

<span class="k">def</span> <span class="n">iterate</span><span class="o">(</span><span class="n">iterations</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">rng0</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> 
  <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span>
  <span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="o">(</span><span class="n">iterations</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)).</span><span class="n">foldLeft</span><span class="o">((</span><span class="mi">0</span><span class="o">,</span> <span class="n">rng0</span><span class="o">))</span> <span class="o">{</span>
  <span class="k">case</span> <span class="o">((</span><span class="n">randIntI</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">rngI</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">),</span> <span class="n">iter</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="n">println</span><span class="o">(</span><span class="s">s&quot;.. </span><span class="si">$iter</span><span class="s"> .. </span><span class="si">$randIntI</span><span class="s"> .. </span><span class="si">$rngI</span><span class="s">&quot;</span><span class="o">)</span>
    <span class="n">rngI</span><span class="o">.</span><span class="n">nextInt</span>
  <span class="o">}</span>

<span class="n">println</span><span class="o">(</span><span class="n">iterate</span><span class="o">(</span><span class="mi">32</span><span class="o">)(</span><span class="n">rng0</span><span class="o">))</span>
</pre></div>

<p><br />
<br />
<br /></p>
<p>Defined in <code>slideCode.lecture6.RNGPrimitiveExamples</code></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              7/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>[info] Running slideCode.lecture6.
         RNGPrimitiveExamples 
iter: 0 randInt: 0 rngI: RNG(123)
iter: 1 randInt: 47324114 rngI: RNG(31014..802)
iter: 2 randInt: -386449838 rngI: RNG(25614..869)
iter: 3 randInt: 806037626 rngI: RNG(52824..4818)
iter: 4 randInt: -1537559018 rngI: RNG(180..38287)
...
iter: 28 randInt: 1770503168 rngI: RNG(11316..223)
iter: 29 randInt: 265482177 rngI: RNG(1736..462)
iter: 30 randInt: -1627823703 rngI: RNG(179..50073)
iter: 31 randInt: -683498645 rngI: RNG(236..41456)
(-1680880615,RNG(171316784789787))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              8/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can begin to manipulate <code>RNG</code> to generate different random types:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">nonNegativeInt</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="k">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">nextInt</span>
    <span class="o">(</span><span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">-(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="k">else</span> <span class="n">i</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//Uniform on [0,1]</span>
<span class="k">def</span> <span class="n">double</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="k">=</span> <span class="n">nonNegativeInt</span><span class="o">(</span><span class="n">rng</span><span class="o">)</span>
    <span class="o">(</span><span class="n">i</span> <span class="o">/</span> <span class="o">(</span><span class="nc">Int</span><span class="o">.</span><span class="nc">MaxValue</span><span class="o">.</span><span class="n">toDouble</span> <span class="o">+</span> <span class="mi">1</span><span class="o">),</span> <span class="n">r</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              9/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>... or pairs of types.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">intDouble</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">((</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Double</span><span class="o">),</span> <span class="nc">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">r1</span><span class="o">)</span> <span class="k">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">nextInt</span>
    <span class="k">val</span> <span class="o">(</span><span class="n">d</span><span class="o">,</span> <span class="n">r2</span><span class="o">)</span> <span class="k">=</span> <span class="n">double</span><span class="o">(</span><span class="n">r1</span><span class="o">)</span>
    <span class="o">((</span><span class="n">i</span><span class="o">,</span> <span class="n">d</span><span class="o">),</span> <span class="n">r2</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>

<p>However this is tedious and error-prone.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              10/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>What common pattern is shared between these type signatures?</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">iterate</span><span class="o">(</span><span class="n">iters</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">rng0</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span> 
<span class="k">def</span> <span class="n">nonNegativeInt</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">def</span> <span class="n">double</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">,</span> <span class="kt">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">def</span> <span class="n">intDouble</span><span class="o">(</span><span class="n">rng</span><span class="k">:</span> <span class="kt">RNG</span><span class="o">)</span><span class="k">:</span> <span class="o">((</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Double</span><span class="o">),</span> <span class="nc">RNG</span><span class="o">)</span> <span class="k">=</span> <span class="o">???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              11/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We factor this commonality out into a type:</p>
<div class="highlight"><pre><span></span><span class="k">type</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">RNG</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="nc">RNG</span><span class="o">)</span>
</pre></div>

<p><br> 
This means we can create a <code>Rand[Int]</code> directly from an <code>RNG</code> for example:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">int</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">_</span><span class="o">.</span><span class="n">nextInt</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              12/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Combinators on <code>Rand</code></h1></header>
            
            
            <section><p>Note that <code>Rand</code> is a type, not a class or trait, so we define our combinators in a companion object.</p>
<div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">Rand</span> <span class="o">{</span>
  <span class="c1">// primitive</span>
  <span class="k">def</span> <span class="n">unit</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">g</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> 
    <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>

  <span class="c1">// derived  </span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> 
  <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="n">map2</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span>,<span class="kt">C</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">rb</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span>
  <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">C</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
  <span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fs</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span><span class="k">:</span> 
  <span class="kt">Rand</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span> <span class="o">???</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              13/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>How would you implement <code>map</code> for <code>Rand[A]</code>?
<br></p>
<p>Given <code>int</code>, re-implement <code>double</code> using <code>map</code>. Ignore the edge case.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              14/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">rng</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">val</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">rng1</span><span class="o">)</span> <span class="k">=</span> <span class="n">ra</span><span class="o">(</span><span class="n">rng0</span><span class="o">)</span>
        <span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">),</span> <span class="n">rng1</span><span class="o">)</span>
    <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              15/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">double</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> 
  <span class="n">map</span><span class="o">(</span><span class="n">int</span><span class="o">)</span> <span class="o">{</span>
    <span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">toDouble</span> <span class="o">/</span> <span class="nc">Int</span><span class="o">.</span><span class="nc">MaxValue</span>
  <span class="o">}</span>
</pre></div>

<p>Note that no explicit <code>RNG</code> value is necessary anywhere in this implementation of <code>double</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              16/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">g</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> 
   <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> 
   <span class="n">rng</span> <span class="k">=&gt;</span> <span class="o">{</span>
      <span class="k">val</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">rng1</span><span class="o">)</span> <span class="k">=</span> <span class="n">ra</span><span class="o">(</span><span class="n">rng0</span><span class="o">)</span>
      <span class="n">g</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="n">rng1</span><span class="o">)</span> <span class="c1">//pass the new state along</span>
    <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              17/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">map2</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span>, <span class="kt">C</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">rb</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span>
  <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">C</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">C</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">flatMap</span><span class="o">(</span><span class="n">ra</span><span class="o">)</span> <span class="o">{</span> <span class="n">a</span> <span class="k">=&gt;</span>
    <span class="n">map</span><span class="o">(</span><span class="n">rb</span><span class="o">)</span> <span class="o">{</span> <span class="n">b</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">}</span>
</pre></div>

<p>Note that <code>map2</code> is a <em>non-primitive</em> combinator so we don't have to handle any <code>RNG</code> values explicitly. </p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              18/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Passing <code>RNG</code> implicitly</h1></header>
            
            
            <section><p><code>Rand</code> passes the <code>RNG</code> values for us.</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">simple</span> <span class="k">=</span> <span class="nc">RNG</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>
<span class="k">def</span> <span class="n">double</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="k">def</span> <span class="n">both</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">rb</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span> <span class="k">=</span>
    <span class="n">map2</span><span class="o">(</span><span class="n">ra</span><span class="o">,</span> <span class="n">rb</span><span class="o">)((</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">))</span>

<span class="n">println</span><span class="o">(</span><span class="n">map2</span><span class="o">(</span><span class="n">double</span><span class="o">,</span> <span class="n">double</span><span class="o">)(</span><span class="n">addDoubles</span><span class="o">)(</span><span class="n">simple</span><span class="o">))</span>
<span class="c1">// ((0.022037,-0.179954),RNG(256148600186669))</span>
</pre></div>

<p>If <code>RNG</code> were not passed through <code>map2</code> correctly, <code>x</code> and <code>y</code> would be the same value. </p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              19/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>How many steps are there from <code>RNG(123)</code> to <code>RNG(256148600186669)</code>?</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              20/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>scala&gt; val a = RNG(123)
a: RNG = RNG(123)
scala&gt; a.nextInt
res0: (Int, RNG) = (47324114,RNG(3101433181802))
scala&gt; res0._2.nextInt
res1: (Int, RNG) = (-386449838,RNG(256148600186669))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              21/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>What does <code>unit</code> do?</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">unit</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">rng</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">rng</span><span class="o">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              22/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>scala&gt; val u = unit(1)
u: Rand[Int] = &lt;function1&gt;
scala&gt; u(a)
res2: (Int, RNG) = (1,RNG(123))
</code></pre>
<p><br>
What is the use of a random number generator that always returns the same number?</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              23/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>This implementation of <code>map</code> makes it a <em>non-primitive</em> combinator.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">flatMap</span><span class="o">(</span><span class="n">ra</span><span class="o">)((</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">unit</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span>
</pre></div>

<p><code>unit</code> is one of the primitive combinators required for the Monad typeclass.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              24/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">g</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> 
    <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> 
    <span class="n">rng</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">val</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">rng1</span><span class="o">)</span> <span class="k">=</span> <span class="n">ra</span><span class="o">(</span><span class="n">rng0</span><span class="o">)</span>
        <span class="n">g</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="n">rng1</span><span class="o">)</span> 
    <span class="o">}</span>
<span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">g</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> 
    <span class="kt">Rand</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">rng</span> <span class="k">=&gt;</span> <span class="o">{</span>
        <span class="k">val</span> <span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">rng1</span><span class="o">)</span> <span class="k">=</span> <span class="n">ra</span><span class="o">(</span><span class="n">rng0</span><span class="o">)</span>
        <span class="o">(</span><span class="n">g</span><span class="o">(</span><span class="n">a</span><span class="o">),</span> <span class="n">rng1</span><span class="o">)</span>
    <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              25/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Because <code>flatMap</code> can exit its context it can be used to implement recursive methods such as <a href="https://en.wikipedia.org/wiki/Rejection_sampling">rejection sampling</a>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">rejectionSampler</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">ra</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">flatMap</span><span class="o">(</span><span class="n">ra</span><span class="o">)</span> <span class="o">{</span> <span class="n">a</span> <span class="k">=&gt;</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">(</span><span class="n">a</span><span class="o">))</span> <span class="n">unit</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
      <span class="k">else</span> <span class="n">rejectionSampler</span><span class="o">(</span><span class="n">ra</span><span class="o">)(</span><span class="n">p</span><span class="o">)</span>
    <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              26/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>scala&gt; rejectionSampler(int)(_ % 5 ==0)(a)
res3: (Int, RNG) = (936386220,RNG(61367007330318))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              27/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Recall that "nesting" is synonymous with <code>flatMap</code>, i.e. nested <code>Rand</code>s are <code>flatMapped</code> together.</p>
<p>We will make use of <code>rejectionSampler</code> extensively in Friday's lab.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              28/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fs</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]])</span><span class="k">:</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]]</span> <span class="k">=</span>
    <span class="n">fs</span><span class="o">.</span><span class="n">foldRight</span><span class="o">(</span><span class="n">unit</span><span class="o">(</span><span class="nc">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]()))</span>
        <span class="o">((</span><span class="n">f</span><span class="o">,</span> <span class="n">acc</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">map2</span><span class="o">(</span><span class="n">f</span><span class="o">,</span> <span class="n">acc</span><span class="o">)(</span><span class="k">_</span> <span class="o">::</span> <span class="k">_</span><span class="o">))</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              29/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>scala&gt; sequence(List(int))(a)
res4: (List(47324114),RNG(3101433181802))
scala&gt; sequence(List(int,int))(a)
res5: (List(47324114, -386449838),RNG(256148600186669))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              30/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Next steps</h1></header>
            
            
            <section><p><code>Rand</code> generalizes to the <code>State</code> monad</p>
<p>With <code>Rand</code>, we transformed the transitions between <code>RNG</code>s.
<br />
With <code>State</code>, we will transform the transitions between generic states
<br /></p>
<p>Today's "state" was a <code>RNG</code>.</p>
<div class="highlight"><pre><span></span><span class="k">type</span> <span class="kt">Rand</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">RNG</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="nc">RNG</span><span class="o">)</span>

<span class="k">type</span> <span class="kt">State</span><span class="o">[</span><span class="kt">S</span>,<span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">S</span> <span class="k">=&gt;</span> <span class="o">(</span><span class="n">A</span><span class="o">,</span> <span class="n">S</span><span class="o">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              31/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>http://eed3si9n.com/herding-cats/State.html</p>
<p>Generalize to StateT</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              32/33
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture6.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p><a href="https://en.wikipedia.org/wiki/Monad_(functional_programming)#State_monads">State_monads</a></p>
<div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">]</span> <span class="o">&gt;&gt;=</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">odd</span> <span class="n">x</span> <span class="kr">then</span> <span class="n">x</span><span class="kt">:</span><span class="n">x</span><span class="kt">:[]</span> <span class="kr">else</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture6.md">lecture6.md</a>
            </aside>
            
            <aside class="page_number">
              33/33
            </aside>

          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Lecture 6: Purely Functional State</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">-</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">-</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">-</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">-</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">-</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">Exercise</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">-</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">-</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">-</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Exercise</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">-</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Combinators on <code>Rand</code></a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">Exercise</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">-</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">-</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">-</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">-</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">Passing <code>RNG</code> implicitly</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Exercise</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">-</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">Exercise</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">-</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">-</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">-</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">-</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">-</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">-</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">-</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">-</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">Next steps</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">-</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">-</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>