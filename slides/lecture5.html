<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lecture 5: Laziness and Streams</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>
<body style="!important;">
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Lecture 5: Laziness and Streams</h1></header>
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              1/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>In this course we will explore a series of methods for separating program description from program evaluation.
<br />
<br />
This line of inquiry leads ultimately to the <code>Free</code> monad in lecture 13.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              2/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Eval Monad</h1></header>
            
            
            <section><p><code>cats.Eval</code> is a monad that allows us to abstract over different models of evaluation.</p>
<p>It is somewhat similar to <code>scala.concurrent.Future</code> from the standard library and <code>fs2.Task</code> from the <a href="https://github.com/functional-streams-for-scala/fs2">Functional Streams for Scala library</a>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              3/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>We typically hear of two such evaluation models: eager and lazy.</p>
<p>Eager computations happen immediately, whereas lazy computations happen only upon access.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              4/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can see this using a computation with a visible side-effect:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Computing x&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span> <span class="o">}</span>
<span class="c1">//Computing x</span>
<span class="c1">//x: Int = 2</span>
<span class="n">x</span>
<span class="c1">//res0: Int = 2</span>
<span class="n">x</span>
<span class="c1">//res1: Int = 2</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              5/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>By contrast, <code>def</code>s are lazy and not memoized:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">y</span> <span class="k">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Computing y&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">}</span>
<span class="c1">//y: Int</span>
<span class="n">y</span>
<span class="c1">//Computing y</span>
<span class="c1">//res2: Int = 2</span>
<span class="n">y</span>
<span class="c1">//Computing y</span>
<span class="c1">//res3: Int = 2</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              6/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Last but not least, lazy vals are lazy and memoized:</p>
<div class="highlight"><pre><span></span><span class="k">lazy</span> <span class="k">val</span> <span class="n">z</span> <span class="k">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Computing z&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">}</span>
<span class="c1">//z: Int = &lt;lazy&gt;</span>
<span class="n">z</span>
<span class="c1">// Computing z</span>
<span class="c1">//res4: Int = 2</span>
<span class="n">z</span>
<span class="c1">//res5: Int = 2</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              7/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p><code>Eval</code> has three subtypes: <code>Eval.Now</code>, <code>Eval.Later</code>, and <code>Eval.Always</code>:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.Eval</span>
<span class="k">val</span> <span class="n">now</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span><span class="o">({</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">})</span>
<span class="c1">//foo</span>
<span class="c1">//now: cats.Eval[Int] = Now(2)</span>
<span class="k">val</span> <span class="n">later</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">later</span><span class="o">({</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">})</span>
<span class="c1">//later: cats.Eval[Int] = cats.Later@24a2a9b8</span>
<span class="n">later</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//foo</span>
<span class="c1">//res0: Int = 2</span>
<span class="n">later</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//res1: Int = 2</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              8/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">always</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span><span class="o">({</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">);</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">})</span>
<span class="c1">//always: cats.Eval[Int] = cats.Always@773adb25</span>
<span class="n">always</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//foo</span>
<span class="c1">//res2: Int = 2</span>
<span class="n">always</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//foo</span>
<span class="c1">//res3: Int = 2</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              9/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>The three behaviors are summarized below:</p>
<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;border-color:#ccc;margin:0px auto;}
.tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#fff;}
.tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#ccc;color:#333;background-color:#f0f0f0;}
.tg .tg-9hbo{font-weight:bold;vertical-align:top}
.tg .tg-yw4l{vertical-align:top}
</style>

<table class="tg">
 <tr>
   <th class="tg-9hbo"></th>
   <th class="tg-9hbo">Eager</th>
   <th class="tg-9hbo">Lazy</th>
 </tr>
 <tr>
   <td class="tg-9hbo">Memoized</td>
   <td class="tg-yw4l">`val, Eval.now`</th>
   <td class="tg-yw4l">`lazy val, Eval.later`</th>
 </tr>
 <tr>
   <td class="tg-9hbo">Not Memoized</td>
   <td class="tg-yw4l">-</th>   
   <td class="tg-yw4l">`def, Eval.always`</th>
 </tr>
</table></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              10/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p><code>Eval</code>s <code>map</code> and <code>flatMap</code> methods add computations to a chain:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">greeting</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Step 1&quot;</span><span class="o">)</span>
  <span class="s">&quot;Hello&quot;</span>
  <span class="o">}.</span><span class="n">map</span> <span class="o">{</span> <span class="n">str</span> <span class="k">=&gt;</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Step 2&quot;</span><span class="o">)</span>
    <span class="n">str</span> <span class="o">+</span> <span class="s">&quot; world&quot;</span>
  <span class="o">}</span>
<span class="c1">//greeting: cats.Eval[String] = cats.Eval$$anon$8@411b9c5f</span>
<span class="n">greeting</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//Step 1</span>
<span class="c1">//Step 2</span>
<span class="c1">//res0: String = Hello world</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              11/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p><code>Eval</code> also supports for comprehensions:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">ans</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
    <span class="n">a</span> <span class="k">&lt;-</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Calculating A&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="mi">40</span> <span class="o">}</span>
    <span class="n">b</span> <span class="k">&lt;-</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">now</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Calculating B&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="mi">2</span> <span class="o">}</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Adding A and B&quot;</span><span class="o">);</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span>
  <span class="o">}</span>
<span class="c1">//Calculating A</span>
<span class="c1">//ans: cats.Eval[Int] = cats.Eval$$anon$8@f636c08</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              12/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Note that, while the semantics of the originating <code>Eval</code> instances are maintained, mapping functions are always called lazily on demand:</p>
<div class="highlight"><pre><span></span><span class="n">ans</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//Calculating B</span>
<span class="c1">//Adding A and B</span>
<span class="c1">//res0: Int = 42</span>
<span class="n">ans</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//Calculating B</span>
<span class="c1">//Adding A and B</span>
<span class="c1">//res1: Int = 42</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              13/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can use <code>Eval</code>'s <code>memoize</code> method to memoize a chain of computations.</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">saying</span> <span class="k">=</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">always</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Step 1&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="s">&quot;The cat&quot;</span> <span class="o">}</span>
  <span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">str</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Step 2&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="n">str</span> <span class="o">+</span> <span class="s">&quot; sat on&quot;</span> <span class="o">}.</span><span class="n">memoize</span>
  <span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">str</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Step 3&quot;</span><span class="o">)</span> <span class="o">;</span> <span class="n">str</span> <span class="o">+</span> <span class="s">&quot; the mat&quot;</span> <span class="o">}</span>
<span class="c1">//saying: cats.Eval[String] = cats.Eval$$anon$8@24c1a639</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              14/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Calculations before the call to memoize are cached, whereas calculations after the call retain their original semantics:</p>
<div class="highlight"><pre><span></span><span class="n">saying</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//Step 1</span>
<span class="c1">//Step 2</span>
<span class="c1">//Step 3</span>
<span class="c1">//res0: String = The cat sat on the mat</span>
<span class="n">saying</span><span class="o">.</span><span class="n">value</span>
<span class="c1">//Step 3</span>
<span class="c1">//res1: String = The cat sat on the mat</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              15/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>One useful property of <code>Eval</code> is that its <code>map</code> and <code>flatMap</code> methods are trampolined.</p>
<p>This means we can nest calls to <code>map</code> and <code>flatMap</code> arbitrarily without consuming stack frames.</p>
<p>We’ll illustrate this by comparing <code>Eval</code> to <code>Option</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              16/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>The <code>loopM</code> method below creates a loop through a monad’s <code>flatMap</code>:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.Monad</span>
<span class="k">import</span> <span class="nn">cats.syntax.flatMap._</span>
<span class="k">import</span> <span class="nn">scala.language.higherKinds</span>
<span class="k">def</span> <span class="n">stackDepth</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="nc">Thread</span><span class="o">.</span><span class="n">currentThread</span><span class="o">.</span><span class="n">getStackTrace</span><span class="o">.</span><span class="n">length</span>
<span class="k">def</span> <span class="n">loopM</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="kt">:</span> <span class="kt">Monad</span><span class="o">](</span><span class="n">m</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">Int</span><span class="o">],</span> <span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">M</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">s&quot;Stack depth </span><span class="si">$stackDepth</span><span class="s">&quot;</span><span class="o">)</span>
  <span class="n">count</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="n">m</span>
    <span class="k">case</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="n">m</span><span class="o">.</span><span class="n">flatMap</span> <span class="o">{</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">loopM</span><span class="o">(</span><span class="n">m</span><span class="o">,</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              17/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>When we run <code>loopM</code> with an <code>Option</code> we can see the stack depth slowly increasing:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.std.option._</span>
<span class="k">import</span> <span class="nn">cats.syntax.option._</span>
<span class="n">loopM</span><span class="o">(</span><span class="mf">1.</span><span class="n">some</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="c1">//Stack depth 45</span>
<span class="c1">//Stack depth 52</span>
<span class="c1">//Stack depth 59</span>
<span class="c1">//Stack depth 66</span>
<span class="c1">//res0: Option[Int] = Some(1)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              18/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Now let’s see the same thing using <code>Eval</code>. The trampoline keeps the stack depth constant:</p>
<div class="highlight"><pre><span></span><span class="n">loopM</span><span class="o">(</span><span class="nc">Eval</span><span class="o">.</span><span class="n">now</span><span class="o">(</span><span class="mi">1</span><span class="o">),</span> <span class="mi">3</span><span class="o">).</span><span class="n">value</span>
<span class="c1">//Stack depth 45</span>
<span class="c1">//Stack depth 49</span>
<span class="c1">//Stack depth 49</span>
<span class="c1">//Stack depth 49</span>
<span class="c1">//res1: Int = 1</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              19/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Streams</h1></header>
            
            
            <section><p>Recall the definition of a simple list:</p>
<div class="highlight"><pre><span></span><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">List</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="c1">//base trait</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Nil</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Cons</span><span class="o">[</span><span class="kt">+A</span><span class="o">](</span><span class="n">head</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span>
                    <span class="n">tail</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
  <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              20/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>A <code>Stream</code> is nothing other than a lazily evaluated list:</p>
<div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="c1">//base trait</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Empty</span> <span class="k">extends</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Cons</span><span class="o">[</span><span class="kt">+A</span><span class="o">](</span><span class="n">h</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span>
                    <span class="n">t</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
  <span class="k">extends</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              21/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>The most important difference between the two:</p>
<ul>
<li>the tail of <code>Cons</code> of <code>List</code> is <em>eager</em></li>
<li>the tail of <code>Cons</code> of <code>Stream</code> is <em>lazy</em></li>
</ul>
<p>Like lists, streams are monadic. Non-empty streams (e.g. zippers) are also commonly used comonads. More on this later.  </p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              22/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Note the type has been inferred as <code>Cons[Int]</code> rather than <code>Stream[Int]</code>:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="nc">Cons</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="nc">Cons</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="mi">2</span><span class="o">,</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="nc">Empty</span><span class="o">))</span>
<span class="c1">//res0 = Cons(&lt;function0&gt;,&lt;function0&gt;)</span>
<span class="n">s</span><span class="o">.</span><span class="n">h</span>
<span class="c1">//res1: () =&gt; Int = &lt;function0&gt;</span>
<span class="n">s</span><span class="o">.</span><span class="n">h</span><span class="o">()</span>
<span class="c1">//res2: Int = 1</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              23/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>The smart constructor memoizes and hides the thunks as well as assisting with type inference:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">cons</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">hd</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">tl</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span>
  <span class="kt">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">lazy</span> <span class="k">val</span> <span class="n">head</span> <span class="k">=</span> <span class="n">hd</span>
    <span class="k">lazy</span> <span class="k">val</span> <span class="n">tail</span> <span class="k">=</span> <span class="n">tl</span>
    <span class="nc">Cons</span><span class="o">(()</span> <span class="k">=&gt;</span> <span class="n">head</span><span class="o">,</span> <span class="o">()</span> <span class="k">=&gt;</span> <span class="n">tail</span><span class="o">)</span>
    <span class="o">}</span>
<span class="k">def</span> <span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Empty</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              24/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Note that the call-by-name syntax in the smart constructor removes need for thunks:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">cons</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">cons</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="n">empty</span><span class="o">))</span>
<span class="c1">//s: Stream[Int] = Cons(&lt;function0&gt;,&lt;function0&gt;)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              25/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>Use the <code>cons</code> smart constructor to implement a sine wave sampled at multiples of π/3 radians.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              26/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Here's one approach. Create the top half of the circle 'by hand', then use it to create the bottom half :</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">sinePos</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
<span class="k">def</span> <span class="n">sineNeg</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span> <span class="n">sinePos</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">d</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">d</span> <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              27/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">sine</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span>
    <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span>
      <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)/</span><span class="mi">2</span><span class="o">,</span>
        <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="mf">1.0</span><span class="o">,</span>
          <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="mi">3</span><span class="o">)/</span><span class="mi">2</span><span class="o">,</span>
            <span class="nc">Stream</span><span class="o">.</span><span class="n">cons</span><span class="o">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="n">sineNeg</span><span class="o">)</span>
  <span class="o">)))))</span>
<span class="n">sine</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">32</span><span class="o">)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              28/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>0.0
0.5
0.8660254037844386
1.0
0.8660254037844386
0.5
-0.0
-0.5
-0.8660254037844386
-1.0
-0.8660254037844386
-0.5
0.0
0.5
...
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              29/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>We can turn an infinite <code>Stream</code> into a finite <code>Stream</code> with <code>take</code>.  </p>
<p><code>foo.take(6)</code> will insert an <code>Empty</code> after the sixth element of <code>foo</code>.</p>
<div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="k">this</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">)</span> <span class="k">if</span> <span class="o">???</span> <span class="k">=&gt;</span> <span class="o">???</span>
      <span class="k">case</span> <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">)</span> <span class="k">if</span> <span class="o">???</span> <span class="k">=&gt;</span> <span class="o">???</span>
      <span class="k">case</span> <span class="nc">Empty</span> <span class="k">=&gt;</span> <span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              30/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="k">this</span> <span class="k">match</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">)</span> <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="mi">0</span> <span class="k">=&gt;</span>
        <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="o">))</span>
      <span class="k">case</span> <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">)</span> <span class="k">if</span> <span class="n">n</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="k">=&gt;</span> <span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
      <span class="k">case</span> <span class="nc">Empty</span> <span class="k">=&gt;</span> <span class="n">empty</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              31/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Example: <code>from</code></h1></header>
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">from</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">cons</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">from</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span>
<span class="nc">Stream</span><span class="o">.</span><span class="n">from</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="n">take</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              32/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><pre><code>from(0).take(4)
cons(0, from(1).take(3))
cons(0, cons(1, from(2).take(2)))
cons(0, cons(1, cons(2, from(3).take(1))))
cons(0, cons(1, cons(2, cons(3, from(4).take(0)))))
cons(0, cons(1, cons(2, cons(3, Empty))))
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              33/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Example: Transposition</h1></header>
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">foo</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="o">}</span>
<span class="k">def</span> <span class="n">bar</span><span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span><span class="n">println</span><span class="o">(</span><span class="n">i</span><span class="o">);</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">}</span>
<span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">foo</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="n">bar</span><span class="o">)</span>
<span class="c1">//1</span>
<span class="c1">//2</span>
<span class="c1">//3</span>
<span class="c1">//11</span>
<span class="c1">//12</span>
<span class="c1">//13</span>
<span class="c1">//res0: List[Int] = List(12)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              34/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="nc">Stream</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">foo</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="n">bar</span><span class="o">).</span><span class="n">take</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
<span class="c1">//1</span>
<span class="c1">//11</span>
<span class="c1">//2</span>
<span class="c1">//12</span>
<span class="c1">//3</span>
<span class="c1">//13</span>
<span class="c1">//res1: Stream[Int] = Stream(12)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              35/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>foldRight</h1></header>
            
            
            <section><p>Recall from our folds tutorial that <code>foldRight</code> on a list looks like this:</p>
<div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">List</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">foldRight</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="kt">B</span><span class="o">)</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=</span>
    <span class="k">this</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Nil</span> <span class="k">=&gt;</span> <span class="n">z</span>
      <span class="k">case</span> <span class="nc">Cons</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">tail</span><span class="o">)</span> <span class="k">=&gt;</span>
            <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">tail</span><span class="o">.</span><span class="n">foldRight</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">f</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              36/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can use the same pattern to create an (unsafe) <code>foldRight</code> for our <code>Stream</code>:</p>
<div class="highlight"><pre><span></span><span class="k">trait</span> <span class="nc">Stream</span><span class="o">[</span><span class="kt">+A</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">foldRight</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">z</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span>
      <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">B</span> <span class="o">=</span>
    <span class="k">this</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Empty</span> <span class="k">=&gt;</span> <span class="n">z</span>
        <span class="k">case</span> <span class="n">cons</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">)</span> <span class="k">=&gt;</span>
          <span class="n">f</span><span class="o">(</span><span class="n">head</span><span class="o">,</span> <span class="n">lazyTail</span><span class="o">.</span><span class="n">foldRight</span><span class="o">(</span><span class="n">z</span><span class="o">)(</span><span class="n">f</span><span class="o">))</span>
      <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              37/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Here is the stack-safe trampolined version from <a href="https://github.com/typelevel/cats/blob/master/core/src/main/scala/cats/instances/stream.scala">Cats</a>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">foldRight</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">lb</span><span class="k">:</span> <span class="kt">Eval</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span>
  <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">Eval</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">=&gt;</span> <span class="nc">Eval</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Eval</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Now</span><span class="o">(</span><span class="k">this</span><span class="o">).</span><span class="n">flatMap</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="n">lb</span>
    <span class="k">else</span> <span class="n">f</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="nc">Eval</span><span class="o">.</span><span class="n">defer</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">foldRight</span><span class="o">(</span><span class="n">lb</span><span class="o">)(</span><span class="n">f</span><span class="o">)))</span>
  <span class="o">}</span>
</pre></div>

<p>Note that we don't use pattern matching to deconstruct the stream, since that would needlessly force evaluation of the tail.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              38/39
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture5.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Homework</h1></header>
            
            
            <section><p>Read Chapter 6 of <em>Functional Programming in Scala</em>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture5.md">lecture5.md</a>
            </aside>
            
            <aside class="page_number">
              39/39
            </aside>

          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Lecture 5: Laziness and Streams</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">-</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">Eval Monad</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">-</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">-</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">-</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">-</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">-</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">-</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">-</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">-</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">-</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">-</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">-</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">-</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">-</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">-</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">-</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">-</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">Streams</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">-</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">-</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">-</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">-</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">-</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">Exercise</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">-</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">-</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">-</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">Exercise</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">-</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">Example: <code>from</code></a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">-</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide34">Example: Transposition</a></th>
        <td><a href="#slide34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide35">-</a></th>
        <td><a href="#slide35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide36">foldRight</a></th>
        <td><a href="#slide36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide37">-</a></th>
        <td><a href="#slide37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide38">-</a></th>
        <td><a href="#slide38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide39">Homework</a></th>
        <td><a href="#slide39">39</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>