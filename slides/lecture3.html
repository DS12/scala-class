<!DOCTYPE html>
<!--
  Copyright 2010 Google Inc.

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.

  Original slides: Marcin Wichary (mwichary@google.com)
  Modifications: Ernest Delgado (ernestd@google.com)
                 Alex Russell (slightlyoff@chromium.org)

  landslide modifications: Adam Zapletal (adamzap@gmail.com)
                           Nicolas Perriault (nperriault@gmail.com)
-->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Lecture 3: Monads</title>
    <!-- Styles -->
    
    <link rel="stylesheet" media="print" href="theme/css/print.css">
    <link rel="stylesheet" media="screen, projection" href="theme/css/screen.css">
    
    
    <!-- /Styles -->
    <!-- Javascripts -->
    
    <script type="text/javascript" src="theme/js/slides.js"></script>
    
    
    <!-- /Javascripts -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { availableFonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript"
        src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
</head>
<body style="!important;">
  <div id="blank"></div>
  <div class="presentation">
    <div id="current_presenter_notes">
      <div id="presenter_note"></div>
    </div>
    <div class="slides">
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Lecture 3: Monads</h1></header>
            
            
            <section><p><img src="images/lecture3/gang-of-four-monads.png"  height="400" ></p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              1/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>The Monad Type Class</h1></header>
            
            
            <section><p>Last time we saw that in Haskell the monad type class is written as follows:</p>
<div class="highlight"><pre><span></span><span class="kr">class</span> <span class="kt">Applicative</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="kr">where</span>
    <span class="p">(</span><span class="o">&gt;&gt;=</span><span class="p">)</span>       <span class="ow">::</span> <span class="n">m</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span>
    <span class="n">return</span>      <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">a</span>
    <span class="n">return</span>      <span class="ow">=</span> <span class="n">pure</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              2/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>The Cats monad type class is <code>cats.Monad</code>.
<br />
<br />
Monad extends two other type classes: <code>FlatMap</code>, which provides the <code>flatMap</code> method, and <code>Applicative</code>, which extends <code>Functor</code>.
<br />
<br />
Monads are essentially applicative functors with a <code>join</code>. We’ll discuss applicatives later in the course.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              3/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Monads in Cats</h1></header>
            
            
            <section><p>The syntax for monads comes from three places:</p>
<ul>
<li><code>cats.syntax.flatMap</code> provides syntax for <code>flatMap</code>;</li>
<li><code>cats.syntax.functor</code> provides syntax for <code>map</code>;</li>
<li><code>cats.syntax.applicative</code> provides syntax for <code>pure</code>.</li>
</ul>
<p>This derives from the layout of the functor, applicative, and monad type classes in Haskell.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              4/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">scala.language.higherKinds</span>
<span class="k">import</span> <span class="nn">cats.Monad</span>
<span class="k">import</span> <span class="nn">cats.syntax.functor._</span>
<span class="k">import</span> <span class="nn">cats.syntax.flatMap._</span>
<span class="k">import</span> <span class="nn">cats.syntax.applicative._</span>
<span class="k">import</span> <span class="nn">cats.std.list._</span>
<span class="k">import</span> <span class="nn">cats.std.option</span>
</pre></div>

<p>Note that in practice it’s often easier to import everything in one go from <code>cats.implicits</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              5/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Default Instances</h1></header>
            
            
            <section><p>Cats provides instances for all the monads in the standard library (<code>Option</code>, <code>List</code>, <code>Vector</code> and so on) via <code>cats.std</code>:</p>
<div class="highlight"><pre><span></span><span class="nc">Monad</span><span class="o">[</span><span class="kt">Option</span><span class="o">].</span><span class="n">pure</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="c1">//res0: Option[Int] = Some(3)</span>
<span class="nc">Monad</span><span class="o">[</span><span class="kt">Option</span><span class="o">].</span><span class="n">flatMap</span><span class="o">(</span><span class="n">res0</span><span class="o">)(</span><span class="n">a</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">2</span><span class="o">))</span>
<span class="c1">//res1: Option[Int] = Some(5)</span>
<span class="nc">Monad</span><span class="o">[</span><span class="kt">List</span><span class="o">].</span><span class="n">pure</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="c1">//res2: List[Int] = List(3)</span>
<span class="nc">Monad</span><span class="o">[</span><span class="kt">List</span><span class="o">].</span><span class="n">flatMap</span><span class="o">(</span><span class="n">res2</span><span class="o">)(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="nc">List</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">x</span><span class="o">*</span><span class="mi">10</span><span class="o">))</span>
<span class="c1">//res3: List[Int] = List(3, 30)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              6/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">sumSquare</span><span class="o">[</span><span class="kt">A</span><span class="o">[</span><span class="k">_</span><span class="o">]</span> <span class="kt">:</span> <span class="kt">Monad</span><span class="o">]</span>
  <span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">x</span> <span class="k">=</span> <span class="n">a</span><span class="o">.</span><span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
    <span class="k">val</span> <span class="n">y</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
    <span class="n">x</span> <span class="n">flatMap</span> <span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="n">map</span> <span class="o">(</span><span class="n">y</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="o">))</span>
<span class="o">}</span>
<span class="n">sumSquare</span><span class="o">[</span><span class="kt">Option</span><span class="o">](</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="c1">//res4: Option[Int] = Some(25)</span>
<span class="n">sumSquare</span><span class="o">[</span><span class="kt">List</span><span class="o">](</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>
<span class="c1">//res5: List[Int] = List(25)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              7/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Cats also provides smart constructors and infix notation for bind:</p>
<div class="highlight"><pre><span></span><span class="mf">4.</span><span class="n">some</span> <span class="o">&gt;&gt;=</span> <span class="o">{</span> <span class="n">x</span><span class="k">:</span><span class="kt">Int</span> <span class="o">=&gt;</span> <span class="o">(</span><span class="n">x</span><span class="o">*</span><span class="mi">2</span><span class="o">).</span><span class="n">some</span> <span class="o">}</span>
<span class="c1">//res6: Option[Int] = Some(8)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              8/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Defining Custom Monads</h1></header>
            
            
            <section><p>We can define a monad for a custom type simply by providing the implementations of <code>flatMap</code> and <code>pure</code>:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">myOptionMonad</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">Option</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Option</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
      <span class="n">value</span> <span class="n">flatMap</span> <span class="n">f</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">Some</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              9/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>When you define your own monads you must ensure that they satisfy the monad laws.
<br />
<br />
Understanding what makes sense structurally for a <code>Functor</code>, <code>Applicative</code>, and <code>Monad</code> can tell you what is potentially an valid instance before you’ve written any code.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              10/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>Determine whether <code>CountMe</code> is a valid monad.</p>
<div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span>

<span class="k">val</span> <span class="n">countMeMonad</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">CountMe</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">x</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              11/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="c1">//Left identity: `flatMap pure(a) f == f(a)`</span>
<span class="k">def</span> <span class="n">foo</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Char</span><span class="o">)</span> <span class="k">=</span> <span class="nc">CountMe</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="n">a</span><span class="o">.</span><span class="n">toInt</span><span class="o">)</span>
<span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="n">countMeMonad</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="sc">&#39;a&#39;</span><span class="o">)</span>
<span class="n">countMeMonad</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="n">foo</span> <span class="k">_</span><span class="o">)</span>
<span class="c1">//res7: CountMe[Int] = CountMe(1,97)</span>
<span class="n">foo</span><span class="o">(</span><span class="sc">&#39;a&#39;</span><span class="o">)</span>
<span class="c1">//res8: CountMe[Int] = CountMe(0,97)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              12/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Identity Monad</h1></header>
            
            
            <section><p>The <code>Id</code> monad provides a monad instance for plain values:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.Id</span>
<span class="k">import</span> <span class="nn">cats.syntax.flatMap._</span>
<span class="k">val</span> <span class="n">a</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="mi">3</span>
<span class="c1">// a: cats.Id[Int] = 3</span>
<span class="k">val</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">a</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">2</span><span class="o">)</span>
<span class="c1">// b: cats.Id[Int] = 5</span>
<span class="k">val</span> <span class="n">c</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">2</span>
<span class="c1">// c: cats.Id[Int] = 5</span>
</pre></div>

<p>This seems confusing. How can we flatMap over an <code>Id[Int]</code> and simply add a number to it?</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              13/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>The answer is in the definition of <code>Id</code>:</p>
<div class="highlight"><pre><span></span><span class="k">type</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span>
</pre></div>

<p><br /></p>
<p><code>Id[A]</code> is simply a type alias for <code>A</code> itself. Cats provides the type class instances to allow us to map and flatMap on elements with type <code>Id[A]</code>, but Scala still allows us to operate on them as plain values of type <code>A</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              14/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>Create your own monad instance for <code>Id[A]</code>. How would you define <code>flatMap</code> and <code>pure</code>?</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              15/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">myId</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">Id</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Id</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Id</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">a</span>      
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              16/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="n">myId</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">2</span><span class="o">)</span>
<span class="c1">//res9: cats.Id[Int] = 5</span>
<span class="n">myId</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="s">&quot;hi&quot;</span><span class="o">)(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">myId</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="s">&quot; there!&quot;</span><span class="o">)(</span><span class="n">y</span> <span class="k">=&gt;</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">))</span>
<span class="c1">//res10: cats.Id[String] = hi there!</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              17/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Writer Monad</h1></header>
            
            
            <section><p><code>cats.data.Writer</code> is a monad that lets us carry a log along with a computation.
<br />
<br />
A <code>Writer[W, A]</code> carries two values: a log of type <code>W</code> and a result of type <code>A</code>.
<br />
<br />
We can use it to record messages, errors, or additional data about a computation, and extract the log with the final result.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              18/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>One common use for Writers is logging during multi-threaded computations, where traditional logging can result in interleaved messages from different contexts.
<br />
<br />
With a <code>Writer</code> the log for the computation is appended to the result, so we can run concurrent computations without mixing log messages.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              19/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can create a <code>Writer</code> from a log and a result as follows:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.data.Writer</span>
<span class="k">import</span> <span class="nn">cats.std.vector._</span>
<span class="nc">Writer</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;It all starts here.&quot;</span><span class="o">),</span> <span class="mi">123</span><span class="o">)</span>
<span class="c1">//res11: WriterT[Vector[String],Int] = ...</span>
</pre></div>

<p>We’ve used a <code>Vector</code> to hold our log as it has a more efficient append operation than List.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              20/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Notice that the type of the writer is actually <code>WriterT[Id, Vector[String], Int]</code> instead of <code>Writer[Vector[String], Int]</code> as we might expect.
<br />
<br />
<code>WriterT</code> is an example of an important concept called a “monad transformer”, which we will discuss later.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              21/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>As with other monads, we can also create a <code>Writer</code> using the <code>pure</code> syntax.</p>
<p>In order to use <code>pure</code> the log has to be a type with a <code>Monoid</code>. This tells Cats what to use as the initial empty log:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.syntax.applicative._</span>
<span class="k">type</span> <span class="kt">Logged</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Writer</span><span class="o">[</span><span class="kt">Vector</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>, <span class="kt">A</span><span class="o">]</span>
<span class="mf">123.</span><span class="n">pure</span><span class="o">[</span><span class="kt">Logged</span><span class="o">]</span>
<span class="c1">// res12: Logged[Int] = WriterT((Vector(),123))</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              22/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can create a <code>Writer</code> from a log using the <code>tell</code> syntax. The <code>Writer</code> is initialized with the value <code>Unit</code>:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.syntax.writer._</span>
<span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;msg1&quot;</span><span class="o">,</span> <span class="s">&quot;msg2&quot;</span><span class="o">).</span><span class="n">tell</span>
<span class="c1">//res13: Writer[Vector[String],Unit] = ...</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              23/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>If we have both a result and a log, we can create a <code>Writer</code> in two ways: using the <code>Writer.apply</code> method or the <code>writer</code> smart constructor:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.syntax.writer._</span>
<span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Writer</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;msg1&quot;</span><span class="o">,</span> <span class="s">&quot;msg2&quot;</span><span class="o">),</span> <span class="mi">123</span><span class="o">)</span>
<span class="c1">//a: WriterT[Id,Vector[String],Int] = ...</span>
<span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="mf">123.</span><span class="n">writer</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;msg1&quot;</span><span class="o">,</span> <span class="s">&quot;msg2&quot;</span><span class="o">))</span>
<span class="c1">//b: Writer[Vector[String],Int] = ...</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              24/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>We can extract the result and log from a <code>Writer</code> using the value and written methods respectively:</p>
<pre><code>val result = a.value
//result: Id[Int] = 123
val log = a.written
//log: Id[Vector[String]] = Vector(msg1, msg2)
</code></pre></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              25/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>or both at once using the <code>run</code> method:</p>
<div class="highlight"><pre><span></span><span class="n">a</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//res14: Id[(Vector[String], Int)] = ...</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              26/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Composing and Transforming Writers</h1></header>
            
            
            <section><p>When we transform or map over a <code>Writer</code>, its log is preserved. When we <code>flatMap</code>, the logs of the two <code>Writer</code>s are appended.
<br />
<br />
For this reason it’s good practice to use a log type that has an efficient append operation, such as a <code>Vector</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              27/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">writer1</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">a</span> <span class="k">&lt;-</span> <span class="mf">10.</span><span class="n">pure</span><span class="o">[</span><span class="kt">Logged</span><span class="o">]</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="s">&quot;b&quot;</span><span class="o">).</span><span class="n">tell</span>
  <span class="n">b</span> <span class="k">&lt;-</span> <span class="mf">32.</span><span class="n">writer</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;x&quot;</span><span class="o">,</span> <span class="s">&quot;y&quot;</span><span class="o">))</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="c1">//writer1 = WriterT((Vector(a, b, x, y),42))</span>
<span class="n">writer1</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//res15 = (Vector(a, b, x, y),42)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              28/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>In addition to transforming the result with <code>map</code> and <code>flatMap</code>, we can transform the log with the <code>mapWritten</code> method</p>
<div class="highlight"><pre><span></span><span class="n">writer1</span><span class="o">.</span><span class="n">mapWritten</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">))</span>
<span class="c1">//res16: WriterT[Id,Vector[String],Int] = ...</span>
<span class="n">res16</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//res17 = ???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              29/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can also transform both log and result simultaneously using <code>bimap</code> or <code>mapBoth</code>.
<code>bimap</code> takes two function parameters, one for the log and one for the result. <code>mapBoth</code> takes a single function of two parameters:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">writer2</span> <span class="k">=</span> <span class="n">writer1</span><span class="o">.</span><span class="n">bimap</span><span class="o">(</span>
  <span class="n">log</span> <span class="k">=&gt;</span> <span class="n">log</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">),</span>
  <span class="n">result</span> <span class="k">=&gt;</span> <span class="n">result</span> <span class="o">*</span> <span class="mi">100</span>
<span class="o">)</span>
<span class="n">writer2</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              30/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Interestingly, we can also swap the log and the result.</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">writer3</span> <span class="k">=</span> <span class="n">writer1</span><span class="o">.</span><span class="n">swap</span>
<span class="n">writer3</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//res18 = (42,Vector(a, b, x, y))</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              31/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>This requires a new monoid for the log, which cats provides implicitly.</p>
<div class="highlight"><pre><span></span><span class="k">for</span> <span class="o">{</span>
  <span class="n">a</span> <span class="k">&lt;-</span> <span class="n">writer3</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="mf">10.</span><span class="n">tell</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">a</span>
<span class="c1">//res19 = ???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              32/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>Finally, we can clear the log with the <code>reset</code> method.</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">writer4</span> <span class="k">=</span> <span class="n">writer1</span><span class="o">.</span><span class="n">reset</span>
<span class="n">writer4</span><span class="o">.</span><span class="n">run</span>
<span class="c1">//res20 = (Vector(),42)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              33/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Reader Monad</h1></header>
            
            
            <section><p><code>cats.data.Reader</code> is a monad that allows us to compose operations that depend on some input.
<br />
<br />
Instances of <code>Reader</code> wrap up functions of one argument, providing us with useful methods for composing them.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              34/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>One common use for Readers is injecting dependencies and configurations.
<br />
<br />
If we have a number of operations that all depend on some external configuration (e.g. a <code>SparkContext</code>), we can chain them together using a <code>Reader</code>.
<br />
<br />
The <code>Reader</code> produces one large operation that accepts the configuration as a parameter and runs everything as specified.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              35/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="c1">//basic implementation</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">A</span><span class="o">](</span><span class="n">run</span><span class="k">:</span> <span class="kt">E</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">B</span><span class="o">]</span> <span class="o">{</span> <span class="n">e</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">run</span><span class="o">(</span><span class="n">e</span><span class="o">)).</span><span class="n">run</span><span class="o">(</span><span class="n">e</span><span class="o">)</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
    <span class="nc">Reader</span><span class="o">[</span><span class="kt">E</span>,<span class="kt">B</span><span class="o">]</span> <span class="o">{</span> <span class="n">e</span> <span class="k">=&gt;</span> <span class="n">f</span><span class="o">(</span><span class="n">run</span><span class="o">(</span><span class="n">e</span><span class="o">))</span> <span class="o">}</span>
<span class="o">}</span>
<span class="k">object</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">ask</span><span class="o">[</span><span class="kt">R</span><span class="o">]</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">R</span>, <span class="kt">R</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Reader</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="n">r</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              36/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can create a <code>Reader[A, B]</code> from a function of type <code>A =&gt; B</code> using the <code>Reader.apply</code> constructor:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">cats.data.Reader</span>
<span class="k">def</span> <span class="n">double</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="mi">2</span>
<span class="k">val</span> <span class="n">doubleReader</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Reader</span><span class="o">(</span><span class="n">double</span><span class="o">)</span>
<span class="c1">// doubleReader: Reader[Int,Int] = Kleisli(&lt;function1&gt;)</span>
<span class="k">val</span> <span class="n">double2</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="n">doubleReader</span><span class="o">.</span><span class="n">run</span>
<span class="c1">// double2: Int =&gt; Int = &lt;function1&gt;</span>
<span class="n">double2</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">// res0: Int = 20</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              37/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Note that <code>Reader</code> is implemented in terms of another type called <code>Kleisli</code>.
<br />
<br />
<code>Kleisli</code> arrows are a more general form of the <code>Reader</code> monad that generalize over the type constructor of the result type. We will discuss these more when we get to monad transformers.
<br />
<br />
The type name <code>Kleisli</code> refers to a <a href="https://en.wikipedia.org/wiki/Kleisli_category">Kleisli Category</a>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              38/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Composing Readers</h1></header>
            
            
            <section><p>The power of <code>Reader</code>s comes from their <code>map</code> and <code>flatMap</code> methods, both of which represent kinds of function composition.</p>
<p>The <code>map</code> method simply extends the computation in the <code>Reader</code> by passing its result through a function:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">mapReader</span> <span class="k">=</span> <span class="n">doubleReader</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="s">&quot;!&quot;</span><span class="o">)</span>
<span class="n">mapReader</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              39/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>The <code>flatMap</code> method is more interesting. It allows us to combine two readers that depend on the same input type:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">add1Reader</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Reader</span><span class="o">(</span><span class="k">_</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
<span class="k">val</span> <span class="n">addReaders</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">x</span> <span class="k">&lt;-</span> <span class="n">doubleReader</span>
    <span class="n">y</span> <span class="k">&lt;-</span> <span class="n">add1Reader</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="n">addReaders</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              40/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Notice that the same input value is passed to both <code>doubleReader</code> and <code>add1Reader</code>.
<br />
<br />
This is the value of the <code>Reader</code> monad, which ensures that the same “configuration” (in this case an input number) is passed to each part of the system.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              41/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><p>We can use the output of the prior step to determine which step to run next. For example:</p>
<div class="highlight"><pre><span></span><span class="k">val</span> <span class="n">sub5Reader</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Reader</span><span class="o">(</span><span class="k">_</span> <span class="o">-</span> <span class="mi">5</span><span class="o">)</span>
<span class="k">val</span> <span class="n">sequencingEx</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>, <span class="o">(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">x</span> <span class="k">&lt;-</span> <span class="n">doubleReader</span>
    <span class="n">y</span> <span class="k">&lt;-</span> <span class="k">if</span><span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="o">)</span> <span class="n">sub5Reader</span> <span class="k">else</span> <span class="n">add1Reader</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span>
<span class="n">sequencingEx</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="c1">//???</span>
<span class="n">sequencingEx</span><span class="o">.</span><span class="n">run</span><span class="o">(</span><span class="mi">15</span><span class="o">)</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              42/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise: Dependency Injection</h1></header>
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">areaR</span><span class="o">(</span><span class="n">r</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Double</span>,<span class="kt">Double</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Reader</span> <span class="o">{</span> <span class="n">pi</span> <span class="k">=&gt;</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span> <span class="o">}</span>
<span class="k">val</span> <span class="n">areaRR</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Reader</span><span class="o">[</span><span class="kt">Double</span>,<span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span>
  <span class="nc">Reader</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=&gt;</span> <span class="n">areaR</span><span class="o">(</span><span class="n">r</span><span class="o">)</span> <span class="o">}</span>
<span class="k">def</span> <span class="n">volumeRR</span><span class="o">(</span><span class="n">h</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Reader</span><span class="o">[</span><span class="kt">Double</span>,<span class="kt">Double</span><span class="o">]]</span> <span class="k">=</span>
  <span class="n">areaRR</span> <span class="n">map</span> <span class="o">{</span> <span class="n">areaR</span> <span class="k">=&gt;</span>
    <span class="n">areaR</span> <span class="n">map</span> <span class="o">{</span> <span class="n">a</span> <span class="k">=&gt;</span> <span class="n">a</span> <span class="o">*</span> <span class="n">h</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="k">val</span> <span class="n">volumeRRR</span> <span class="k">=</span> <span class="nc">Reader</span> <span class="o">{</span> <span class="n">h</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">volumeRR</span><span class="o">(</span><span class="n">h</span><span class="o">)</span> <span class="o">}</span>
<span class="c1">//Reader[Int,Reader[Int,Reader[Double,Double]]] = Kleisli(&lt;function1&gt;)</span>
<span class="c1">//What does this remind you of?</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              43/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="n">volumeRR</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="n">run</span> <span class="mi">1</span>
<span class="c1">//???</span>
<span class="n">volumeRRR</span> <span class="n">run</span> <span class="mi">2</span> <span class="n">run</span> <span class="mi">1</span>
<span class="c1">//???</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              44/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="n">volumeRR</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="n">run</span> <span class="mi">1</span>
<span class="c1">//res1: Id[Reader[Double,Double]] = Kleisli(&lt;function1&gt;)</span>
<span class="n">volumeRRR</span> <span class="n">run</span> <span class="mi">2</span> <span class="n">run</span> <span class="mi">1</span>
<span class="c1">//res2: Id[Reader[Double,Double]] = Kleisli(&lt;function1&gt;)</span>
<span class="n">volumeRR</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span> <span class="n">run</span> <span class="mi">1</span> <span class="n">run</span> <span class="mf">3.14</span>
<span class="c1">//res3: Id[Double] = 6.28</span>
<span class="n">volumeRRR</span> <span class="n">run</span> <span class="mi">2</span> <span class="n">run</span> <span class="mi">1</span> <span class="n">run</span> <span class="mf">3.14</span>
<span class="c1">//res4: Id[Double] = 6.28</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              45/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Reader vs State</h1></header>
            
            
            <section><div class="highlight"><pre><span></span><span class="c1">//Reader[S,A] has a run: S =&gt; A</span>
<span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Reader</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">Reader</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">]</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
  <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">//State[S,A] has a run: S =&gt; (S, A)</span>
<span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">State</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">State</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
  <span class="nc">State</span><span class="o">[</span><span class="kt">S</span>, <span class="kt">B</span><span class="o">]</span> <span class="o">{</span> <span class="n">s</span> <span class="k">=&gt;</span> <span class="o">{</span>
   <span class="k">val</span> <span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">a</span><span class="o">)</span> <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
   <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">).</span><span class="n">run</span><span class="o">(</span><span class="n">s1</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              46/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Writer vs State</h1></header>
            
            
            <section><p>The <code>Writer</code> and <code>State</code> monads are also <a href="http://stackoverflow.com/questions/23942890/is-the-writer-monad-effectively-the-same-as-the-state-monad">closely related</a>.
<br />
<br />
The difference is that <code>Writer</code> is much more limited, in that it doesn't allow you to read the accumulated state.
<br />
<br />
The only thing you can do with the state in a Writer is use the monoid to tack more stuff onto the end.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              47/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            <header><h1>Exercise</h1></header>
            
            
            <section><p>Fix <code>CountMe</code>s flatMap so that it is a valid monad.</p>
<div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span>

<span class="k">val</span> <span class="n">countMeMonad</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">CountMe</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">x</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              48/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source:  -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="page_number">
              /54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span>

<span class="k">val</span> <span class="n">countMeMonad2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Monad</span><span class="o">[</span><span class="kt">CountMe</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">B</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span>
    <span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">x</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">count</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">count</span><span class="o">,</span> <span class="n">x</span><span class="o">.</span><span class="n">data</span><span class="o">)</span>
    <span class="o">}</span>
  <span class="k">def</span> <span class="n">pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">CountMe</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
      <span class="nc">CountMe</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              49/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide has_code">
          <div class="inner">
            
            
            <section><div class="highlight"><pre><span></span><span class="k">def</span> <span class="n">foo</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Char</span><span class="o">)</span> <span class="k">=</span> <span class="nc">CountMe</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="n">a</span><span class="o">.</span><span class="n">toInt</span><span class="o">)</span>
<span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="n">countMeMonad2</span><span class="o">.</span><span class="n">pure</span><span class="o">(</span><span class="sc">&#39;a&#39;</span><span class="o">)</span>
<span class="n">countMeMonad2</span><span class="o">.</span><span class="n">flatMap</span><span class="o">(</span><span class="n">a</span><span class="o">)(</span><span class="n">foo</span> <span class="k">_</span><span class="o">)</span>
<span class="c1">//res0: CountMe[Int] = CountMe(0,97)</span>
<span class="n">foo</span><span class="o">(</span><span class="sc">&#39;a&#39;</span><span class="o">)</span>
<span class="c1">//res1: CountMe[Int] = CountMe(0,97)</span>
</pre></div>
</section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              50/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            
            <section><p>Note that this improvement essentially makes our new <code>CountMe</code> monad into a specialized version of <code>Writer</code>.
<br />
<br />
Another 'improvement' would have been to drop the count altogether. This would have created a <code>CountMe</code> monad equivalent to <code>Reader</code>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              51/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Writer vs Reader</h1></header>
            
            
            <section><p>While it may not look like it at first glance, the <code>Writer</code> and <code>Reader</code> monads are actually closely related.</p>
<p>We'll discuss this in more depth when we cover comonads and adjoint functors in lecture 11.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              52/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Homework</h1></header>
            
            
            <section><p>Read Chapter 4 of <em>Functional Programming in Scala</em>.</p></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              53/54
            </aside>

          </footer>
        </div>
      </div>
      
      <!-- slide source: lecture3.md -->
      <div class="slide-wrapper">
        <div class="slide">
          <div class="inner">
            
            <header><h1>Links</h1></header>
            
            
            <section><ul>
<li><a href="http://underscore.io/books/advanced-scala/">Advanced Scala with Cats</a></li>
<li><a href="http://www.haskell.org/haskellwiki/Typeclassopedia">Typeclassopedia</a></li>
</ul></section>
            
          </div>
          <div class="presenter_notes">
            <header><h1>Presenter Notes</h1></header>
            <section>
            
            </section>
          </div>


          <footer>
            
            <aside class="source">
              Source: <a href="lecture3.md">lecture3.md</a>
            </aside>
            
            <aside class="page_number">
              54/54
            </aside>

          </footer>
        </div>
      </div>
      
    </div>
  </div>
  
  <div id="toc" class="sidebar hidden">
    <h2>Table of Contents</h2>
    <table>
      <caption>Table of Contents</caption>
      
      <tr id="toc-row-1">
        <th><a href="#slide1">Lecture 3: Monads</a></th>
        <td><a href="#slide1">1</a></td>
      </tr>
      
      
      <tr id="toc-row-2">
        <th><a href="#slide2">The Monad Type Class</a></th>
        <td><a href="#slide2">2</a></td>
      </tr>
      
      
      <tr id="toc-row-3">
        <th><a href="#slide3">-</a></th>
        <td><a href="#slide3">3</a></td>
      </tr>
      
      
      <tr id="toc-row-4">
        <th><a href="#slide4">Monads in Cats</a></th>
        <td><a href="#slide4">4</a></td>
      </tr>
      
      
      <tr id="toc-row-5">
        <th><a href="#slide5">-</a></th>
        <td><a href="#slide5">5</a></td>
      </tr>
      
      
      <tr id="toc-row-6">
        <th><a href="#slide6">Default Instances</a></th>
        <td><a href="#slide6">6</a></td>
      </tr>
      
      
      <tr id="toc-row-7">
        <th><a href="#slide7">-</a></th>
        <td><a href="#slide7">7</a></td>
      </tr>
      
      
      <tr id="toc-row-8">
        <th><a href="#slide8">-</a></th>
        <td><a href="#slide8">8</a></td>
      </tr>
      
      
      <tr id="toc-row-9">
        <th><a href="#slide9">Defining Custom Monads</a></th>
        <td><a href="#slide9">9</a></td>
      </tr>
      
      
      <tr id="toc-row-10">
        <th><a href="#slide10">-</a></th>
        <td><a href="#slide10">10</a></td>
      </tr>
      
      
      <tr id="toc-row-11">
        <th><a href="#slide11">Exercise</a></th>
        <td><a href="#slide11">11</a></td>
      </tr>
      
      
      <tr id="toc-row-12">
        <th><a href="#slide12">-</a></th>
        <td><a href="#slide12">12</a></td>
      </tr>
      
      
      <tr id="toc-row-13">
        <th><a href="#slide13">Identity Monad</a></th>
        <td><a href="#slide13">13</a></td>
      </tr>
      
      
      <tr id="toc-row-14">
        <th><a href="#slide14">-</a></th>
        <td><a href="#slide14">14</a></td>
      </tr>
      
      
      <tr id="toc-row-15">
        <th><a href="#slide15">Exercise</a></th>
        <td><a href="#slide15">15</a></td>
      </tr>
      
      
      <tr id="toc-row-16">
        <th><a href="#slide16">-</a></th>
        <td><a href="#slide16">16</a></td>
      </tr>
      
      
      <tr id="toc-row-17">
        <th><a href="#slide17">-</a></th>
        <td><a href="#slide17">17</a></td>
      </tr>
      
      
      <tr id="toc-row-18">
        <th><a href="#slide18">Writer Monad</a></th>
        <td><a href="#slide18">18</a></td>
      </tr>
      
      
      <tr id="toc-row-19">
        <th><a href="#slide19">-</a></th>
        <td><a href="#slide19">19</a></td>
      </tr>
      
      
      <tr id="toc-row-20">
        <th><a href="#slide20">-</a></th>
        <td><a href="#slide20">20</a></td>
      </tr>
      
      
      <tr id="toc-row-21">
        <th><a href="#slide21">-</a></th>
        <td><a href="#slide21">21</a></td>
      </tr>
      
      
      <tr id="toc-row-22">
        <th><a href="#slide22">-</a></th>
        <td><a href="#slide22">22</a></td>
      </tr>
      
      
      <tr id="toc-row-23">
        <th><a href="#slide23">-</a></th>
        <td><a href="#slide23">23</a></td>
      </tr>
      
      
      <tr id="toc-row-24">
        <th><a href="#slide24">-</a></th>
        <td><a href="#slide24">24</a></td>
      </tr>
      
      
      <tr id="toc-row-25">
        <th><a href="#slide25">-</a></th>
        <td><a href="#slide25">25</a></td>
      </tr>
      
      
      <tr id="toc-row-26">
        <th><a href="#slide26">-</a></th>
        <td><a href="#slide26">26</a></td>
      </tr>
      
      
      <tr id="toc-row-27">
        <th><a href="#slide27">Composing and Transforming Writers</a></th>
        <td><a href="#slide27">27</a></td>
      </tr>
      
      
      <tr id="toc-row-28">
        <th><a href="#slide28">-</a></th>
        <td><a href="#slide28">28</a></td>
      </tr>
      
      
      <tr id="toc-row-29">
        <th><a href="#slide29">-</a></th>
        <td><a href="#slide29">29</a></td>
      </tr>
      
      
      <tr id="toc-row-30">
        <th><a href="#slide30">-</a></th>
        <td><a href="#slide30">30</a></td>
      </tr>
      
      
      <tr id="toc-row-31">
        <th><a href="#slide31">-</a></th>
        <td><a href="#slide31">31</a></td>
      </tr>
      
      
      <tr id="toc-row-32">
        <th><a href="#slide32">-</a></th>
        <td><a href="#slide32">32</a></td>
      </tr>
      
      
      <tr id="toc-row-33">
        <th><a href="#slide33">-</a></th>
        <td><a href="#slide33">33</a></td>
      </tr>
      
      
      <tr id="toc-row-34">
        <th><a href="#slide34">Reader Monad</a></th>
        <td><a href="#slide34">34</a></td>
      </tr>
      
      
      <tr id="toc-row-35">
        <th><a href="#slide35">-</a></th>
        <td><a href="#slide35">35</a></td>
      </tr>
      
      
      <tr id="toc-row-36">
        <th><a href="#slide36">-</a></th>
        <td><a href="#slide36">36</a></td>
      </tr>
      
      
      <tr id="toc-row-37">
        <th><a href="#slide37">-</a></th>
        <td><a href="#slide37">37</a></td>
      </tr>
      
      
      <tr id="toc-row-38">
        <th><a href="#slide38">-</a></th>
        <td><a href="#slide38">38</a></td>
      </tr>
      
      
      <tr id="toc-row-39">
        <th><a href="#slide39">Composing Readers</a></th>
        <td><a href="#slide39">39</a></td>
      </tr>
      
      
      <tr id="toc-row-40">
        <th><a href="#slide40">-</a></th>
        <td><a href="#slide40">40</a></td>
      </tr>
      
      
      <tr id="toc-row-41">
        <th><a href="#slide41">-</a></th>
        <td><a href="#slide41">41</a></td>
      </tr>
      
      
      <tr id="toc-row-42">
        <th><a href="#slide42">-</a></th>
        <td><a href="#slide42">42</a></td>
      </tr>
      
      
      <tr id="toc-row-43">
        <th><a href="#slide43">Exercise: Dependency Injection</a></th>
        <td><a href="#slide43">43</a></td>
      </tr>
      
      
      <tr id="toc-row-44">
        <th><a href="#slide44">-</a></th>
        <td><a href="#slide44">44</a></td>
      </tr>
      
      
      <tr id="toc-row-45">
        <th><a href="#slide45">-</a></th>
        <td><a href="#slide45">45</a></td>
      </tr>
      
      
      <tr id="toc-row-46">
        <th><a href="#slide46">Reader vs State</a></th>
        <td><a href="#slide46">46</a></td>
      </tr>
      
      
      <tr id="toc-row-47">
        <th><a href="#slide47">Writer vs State</a></th>
        <td><a href="#slide47">47</a></td>
      </tr>
      
      
      <tr id="toc-row-48">
        <th><a href="#slide48">Exercise</a></th>
        <td><a href="#slide48">48</a></td>
      </tr>
      
      
      <tr id="toc-row-49">
        <th><a href="#slide49">-</a></th>
        <td><a href="#slide49">49</a></td>
      </tr>
      
      
      <tr id="toc-row-50">
        <th><a href="#slide50">-</a></th>
        <td><a href="#slide50">50</a></td>
      </tr>
      
      
      <tr id="toc-row-51">
        <th><a href="#slide51">-</a></th>
        <td><a href="#slide51">51</a></td>
      </tr>
      
      
      <tr id="toc-row-52">
        <th><a href="#slide52">Writer vs Reader</a></th>
        <td><a href="#slide52">52</a></td>
      </tr>
      
      
      <tr id="toc-row-53">
        <th><a href="#slide53">Homework</a></th>
        <td><a href="#slide53">53</a></td>
      </tr>
      
      
      <tr id="toc-row-54">
        <th><a href="#slide54">Links</a></th>
        <td><a href="#slide54">54</a></td>
      </tr>
      
      
    </table>
  </div>
  
  <div id="help" class="sidebar hidden">
    <h2>Help</h2>
    <table>
      <caption>Help</caption>
      <tr>
        <th>Table of Contents</th>
        <td>t</td>
      </tr>
      <tr>
        <th>Exposé</th>
        <td>ESC</td>
      </tr>
      <tr>
        <th>Full screen slides</th>
        <td>e</td>
      </tr>
      <tr>
        <th>Presenter View</th>
        <td>p</td>
      </tr>
      <tr>
        <th>Source Files</th>
        <td>s</td>
      </tr>
      <tr>
        <th>Slide Numbers</th>
        <td>n</td>
      </tr>
      <tr>
        <th>Toggle screen blanking</th>
        <td>b</td>
      </tr>
      <tr>
        <th>Show/hide slide context</th>
        <td>c</td>
      </tr>
      <tr>
        <th>Notes</th>
        <td>2</td>
      </tr>
      <tr>
        <th>Help</th>
        <td>h</td>
      </tr>
    </table>
  </div>
  <script>main()</script>
</body>
</html>